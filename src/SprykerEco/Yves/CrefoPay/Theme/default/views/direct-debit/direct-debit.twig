{% extends model('template') %}

{% define data = {
    form: form
} %}

{% block body %}
    {% macro crefopayField(name, attribute, placeholder) %}
        <div class="spacing-y">
            <label class="label label--required">{{ name | trans }}</label>
            <input class="input input--expand" type="text" data-crefopay="{{ attribute }}" placeholder="{{ placeholder | trans }}">
        </div>
    {% endmacro %}

    {% set paymentMethodSubForm = data.form.crefoPayDirectDebit %}
    {% set subFormVars = paymentMethodSubForm.vars %}
    {% set subFormPlaceholders = subFormVars.secureFieldsPlaceholders %}
    {% set crefopayFields = [
        {name: "crefopay.accountholder", attribute: "paymentInstrument.bankAccountHolder", placeholder: subFormPlaceholders.accountHolder},
        {name: "crefopay.iban", attribute: "paymentInstrument.iban", placeholder: subFormPlaceholders.iban},
        {name: "crefopay.bic", attribute: "paymentInstrument.bic", placeholder: subFormPlaceholders.bic}
    ] %}

    {% include atom('crefopay-checkbox-helper', 'Crefopay') with {
        attributes: {
            'trigger-selector': '.js-toggler-radio__trigger',
            'container-selector': '.form',
            'target-selector': '.radio__input',
            'name': 'crefopay-radio',
            'custom-attr-name': 'data-crefopay',
            'custom-attr-value': 'paymentMethod',
            'class-to-add': 'is-hidden'
        }
    } only %}

    {% embed molecule('crefopay-payment-form', 'CrefoPay') with {
        data: {
            paymentMethodSubForm: paymentMethodSubForm,
            shopPublicKey: subFormVars.shopPublicKey,
            orderId: subFormVars.orderID,
            fields: crefopayFields,
            crefoPayConfig: {
                url: subFormVars.secureFieldsApiEndpoint
            }
        },
        embed: {
            fields: crefopayFields,
            context: _self
        }
    } only %}
        {% block requestForm %}
            <div class="is-hidden">
                {{ form_widget(data.paymentMethodSubForm) }}
            </div>
            {% for field in embed.fields %}
                {{ embed.context.crefopayField(field.name, field.attribute, field.placeholder) }}
            {% endfor %}

            <div class="{{ config.name }}__error {{ config.jsName }}__error spacing-y is-hidden">
                {{ 'crefopay.required_notification' | trans }}
            </div>
        {% endblock %}
    {% endembed %}
{% endblock %}
